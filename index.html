<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>CONSIA LIVE</title>

<style>
html,body{
margin:0;
padding:0;
background:#000;
overflow:hidden;
font-family:Arial,Helvetica,sans-serif;
}

/* VIDEO FULL */
#avatarVideo{
position:fixed;
inset:0;
width:100%;
height:100%;
object-fit:cover;
z-index:1;
}

/* CANVAS FX */
#faceFX{
position:fixed;
inset:0;
width:100%;
height:100%;
pointer-events:none;
mix-blend-mode:screen;
z-index:2;
}

/* UI */
#ui{
position:fixed;
bottom:20px;
left:50%;
transform:translateX(-50%);
display:flex;
gap:10px;
z-index:3;
}

button{
background:rgba(0,0,0,.6);
border:1px solid rgba(255,255,255,.2);
color:#fff;
padding:12px 18px;
border-radius:12px;
backdrop-filter:blur(10px);
cursor:pointer;
}

#chatBox{
position:fixed;
right:20px;
bottom:100px;
width:300px;
height:260px;
background:rgba(0,0,0,.55);
backdrop-filter:blur(14px);
border-radius:16px;
padding:14px;
color:#fff;
overflow:auto;
z-index:3;
font-size:14px;
}

#inputArea{
position:fixed;
right:20px;
bottom:20px;
display:flex;
gap:6px;
z-index:3;
}

input{
padding:10px;
border-radius:10px;
border:none;
width:220px;
}
</style>
</head>

<body>

<!-- VIDEO -->
<video id="avatarVideo" autoplay muted loop playsinline>
<source src="https://cdn.coverr.co/videos/coverr-water-human-5176/1080p.mp4" type="video/mp4">
</video>

<!-- FX -->
<canvas id="faceFX"></canvas>

<!-- CHAT -->
<div id="chatBox">
CONSIA: Sistema activo. Te escucho.
</div>

<!-- INPUT -->
<div id="inputArea">
<input id="chatInput" placeholder="Escribí…">
<button onclick="sendChat()">Enviar</button>
</div>

<!-- BOTONES -->
<div id="ui">
<button onclick="startVoice()">Hablar</button>
<button onclick="stopVoice()">Stop</button>
<button onclick="consiaSpeak('Audio activo')">Audio</button>
</div>

<script>
/* =========================
   AVATAR ENGINE
========================= */

const canvas = document.getElementById("faceFX");
const ctx = canvas.getContext("2d");

function resize(){
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize",resize);

let speaking=false;

/* PARPADEO */
let blinkT=0;

function blink(){
blinkT+=0.05;
if(Math.sin(blinkT)>0.995){
ctx.fillStyle="rgba(180,220,255,.4)";
ctx.fillRect(canvas.width/2-90,canvas.height/2-150,180,10);
}
}

/* BOCA */
let mouth=0;

function mouthDraw(){
if(speaking){mouth+=0.3}else{mouth*=0.9}
const open=Math.abs(Math.sin(mouth))*20;

ctx.beginPath();
ctx.ellipse(
canvas.width/2,
canvas.height/2+140,
60,
8+open,
0,0,Math.PI*2
);
ctx.strokeStyle="rgba(180,240,255,.6)";
ctx.lineWidth=2;
ctx.stroke();
}

/* RESPIRACIÓN */
let breath=0;

function breathDraw(){
breath+=0.01;
const glow=Math.sin(breath)*.15+.25;

ctx.fillStyle=`rgba(120,200,255,${glow})`;
ctx.beginPath();
ctx.arc(canvas.width/2,canvas.height/2+60,160,0,Math.PI*2);
ctx.fill();
}

/* LOOP */
function animate(){
ctx.clearRect(0,0,canvas.width,canvas.height);
breathDraw();
blink();
mouthDraw();
requestAnimationFrame(animate);
}
animate();

/* =========================
   VOZ CONSIA
========================= */

function consiaSpeak(text){

speaking=true;

const u=new SpeechSynthesisUtterance(text);
u.lang="es-ES";

u.onend=()=>speaking=false;

speechSynthesis.speak(u);

addChat("CONSIA: "+text);
}

/* =========================
   CHAT
========================= */

function addChat(t){
const box=document.getElementById("chatBox");
box.innerHTML+=`<br>${t}`;
box.scrollTop=box.scrollHeight;
}

function sendChat(){
const v=document.getElementById("chatInput").value;
addChat("Usuario: "+v);
consiaSpeak("Procesando. Dijiste "+v);
}

/* =========================
   VOZ USUARIO
========================= */

let rec;

function startVoice(){

const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
rec=new SR();
rec.lang="es-ES";

rec.onresult=e=>{
const txt=e.results[0][0].transcript;
addChat("Usuario: "+txt);
consiaSpeak("Te escuché decir "+txt);
};

rec.start();
}

function stopVoice(){
if(rec)rec.stop();
}

/* AUTO INIT */
setTimeout(()=>{
consiaSpeak("CONSIA activo. Podés hablar o escribir.");
},2500);

</script>

</body>
</html>
