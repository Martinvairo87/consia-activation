<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<title>CONSIA</title>

<link rel="manifest" href="/manifest.webmanifest">
<link rel="icon" href="/icons/icon-512.png">

<style>
body{
  margin:0;
  font-family:-apple-system,system-ui;
  background:#000;
  color:#fff;
  display:flex;
  flex-direction:column;
  height:100vh;
}
#chat{
  flex:1;
  overflow:auto;
  padding:20px;
}
.msg{
  margin:10px 0;
  padding:12px 16px;
  border-radius:16px;
  max-width:80%;
}
.user{background:#1e1e1e;align-self:flex-end;}
.ai{background:#111;border:1px solid #333;}
#inputBar{
  display:flex;
  padding:10px;
  background:#111;
}
input{
  flex:1;
  padding:12px;
  border-radius:12px;
  border:none;
  font-size:16px;
}
button{
  margin-left:10px;
  padding:12px 18px;
  border:none;
  border-radius:12px;
  background:#fff;
  color:#000;
  font-weight:bold;
}
</style>
</head>

<body>

<div id="chat"></div>

<div id="inputBar">
  <input id="msg" placeholder="Hablar con CONSIA..." />
  <button onclick="send()">Enviar</button>
</div>

<script>
const API="https://api.consia.world/ask";

async function send(){
  const input=document.getElementById("msg");
  const text=input.value.trim();
  if(!text)return;

  addMsg(text,"user");
  input.value="";

  const res=await fetch(API,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      message:text,
      lang:"es",
      audioWanted:true
    })
  });

  const data=await res.json();
  addMsg(data.text,"ai");

  if(data.audio_b64){
    const audio=new Audio(
      "data:"+data.audio_mime+";base64,"+data.audio_b64
    );
    audio.play();
  }
}

function addMsg(t,cls){
  const d=document.createElement("div");
  d.className="msg "+cls;
  d.textContent=t;
  document.getElementById("chat").appendChild(d);
}
</script>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("/sw.js");
}
</script>

</body>
</html>
