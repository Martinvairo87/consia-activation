<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <title>CONSIA ‚àû</title>
  <style>
    :root{
      --bg:#000;
      --txt:#fff;
      --muted:rgba(255,255,255,.75);
      --ui:rgba(10,10,10,.55);
      --ui2:rgba(10,10,10,.78);
      --border:rgba(255,255,255,.16);
      --good:#20ff84;
      --warn:#ffcc00;
      --bad:#ff3b30;
      --r:18px;
      --shadow:0 18px 60px rgba(0,0,0,.55);

      /* Lipsync regions (ajustables en Owner Mode) */
      --mouth-x:50%;
      --mouth-y:70%;
      --mouth-w:26%;
      --mouth-h:14%;
      --eyes-y:46%;
      --eye-w:12%;
      --eye-h:6%;
      --eye-gap:18%;
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    html,body{ margin:0; padding:0; width:100%; height:100%; background:var(--bg); color:var(--txt); font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", system-ui, Segoe UI, Roboto, Helvetica, Arial; overflow:hidden; }
    button{ font:inherit; color:inherit; background:transparent; border:1px solid var(--border); border-radius:999px; padding:10px 14px; cursor:pointer; }
    button:active{ transform:scale(.98); }
    .pill{ background:rgba(255,255,255,.08); border:1px solid var(--border); border-radius:999px; padding:8px 12px; display:inline-flex; gap:8px; align-items:center; }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .dot{ width:10px; height:10px; border-radius:50%; background:var(--bad); box-shadow:0 0 12px rgba(255,0,0,.45); }
    .dot.good{ background:var(--good); box-shadow:0 0 12px rgba(32,255,132,.45); }
    .dot.warn{ background:var(--warn); box-shadow:0 0 12px rgba(255,204,0,.45); }

    /* FULLSCREEN STAGE */
    #stage{
      position:fixed; inset:0;
      width:100vw; height:100vh;
      background:#000;
      overflow:hidden;
    }

    /* Intro video (auto) */
    #introWrap{
      position:absolute; inset:0;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:30;
      opacity:1;
      transition:opacity .35s ease;
    }
    #introWrap.hidden{ opacity:0; pointer-events:none; }
    #introVideo{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      filter:contrast(1.05) saturate(1.05);
    }
    #introOverlay{
      position:absolute; inset:0;
      background:radial-gradient(60% 60% at 50% 40%, rgba(0,0,0,.15), rgba(0,0,0,.75));
    }
    #skipIntro{
      position:absolute;
      right:16px; top:16px;
      z-index:31;
      backdrop-filter: blur(10px);
      background:rgba(0,0,0,.25);
    }

    /* Avatar base fullscreen */
    #avatarBase{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;            /* FULLSCREEN (sin corte percibido) */
      object-position:center center;
      transform:translateZ(0);
      filter:contrast(1.06) saturate(1.05);
      z-index:1;
    }
    /* Soft vignette */
    #vignette{
      position:absolute; inset:-20px;
      background:radial-gradient(60% 60% at 50% 40%, rgba(0,0,0,.08), rgba(0,0,0,.78));
      z-index:2;
      pointer-events:none;
    }

    /* Face FX canvas (lipsync + gestures) */
    #fx{
      position:absolute; inset:0;
      width:100%; height:100%;
      z-index:3;
      pointer-events:none;
      mix-blend-mode:screen;
      opacity:.85;
    }

    /* UI Overlay */
    #hud{
      position:absolute; left:14px; right:14px; top:12px;
      z-index:10;
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      pointer-events:none;
    }
    #hud .row{ pointer-events:auto; }
    #brand{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:999px;
      background:rgba(0,0,0,.25);
      border:1px solid var(--border);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
    }
    #brand b{ letter-spacing:.5px; }
    #statusBar{
      display:flex; gap:10px; align-items:center;
      padding:10px 12px;
      border-radius:999px;
      background:rgba(0,0,0,.25);
      border:1px solid var(--border);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
    }

    /* Controls */
    #controls{
      position:absolute; left:14px; right:14px; bottom:14px;
      z-index:12;
      display:flex; flex-direction:column; gap:10px;
      pointer-events:none;
    }
    #controls .row{ pointer-events:auto; }
    #chat{
      pointer-events:auto;
      border:1px solid var(--border);
      border-radius: var(--r);
      background:rgba(0,0,0,.35);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    #log{
      height:210px;
      overflow:auto;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      scrollbar-width: thin;
    }
    .msg{
      padding:10px 12px;
      border-radius:14px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      max-width:92%;
      white-space:pre-wrap;
      line-height:1.25;
    }
    .msg.sys{ opacity:.9; background:rgba(255,255,255,.04); }
    .msg.you{ align-self:flex-end; background:rgba(32,255,132,.10); border-color:rgba(32,255,132,.22); }
    .msg.ai{ align-self:flex-start; background:rgba(255,255,255,.07); }
    #composer{
      display:flex; gap:10px; padding:12px;
      border-top:1px solid rgba(255,255,255,.10);
      align-items:center;
      background:rgba(0,0,0,.25);
    }
    #input{
      flex:1;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius:999px;
      padding:12px 14px;
      color:#fff;
      outline:none;
    }
    #send{
      background:rgba(255,255,255,.10);
    }

    /* Minimal modal (Owner) */
    #ownerModal{
      position:fixed; inset:0;
      z-index:50;
      background:rgba(0,0,0,.65);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    #ownerModal.on{ display:flex; }
    #ownerCard{
      width:min(820px, 100%);
      border-radius:22px;
      background:rgba(10,10,10,.85);
      border:1px solid rgba(255,255,255,.16);
      backdrop-filter: blur(16px);
      box-shadow: var(--shadow);
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    #ownerCard textarea{
      width:100%;
      min-height:140px;
      resize:none;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:#fff;
      padding:12px;
      outline:none;
    }
  </style>
</head>
<body>
  <div id="stage">
    <!-- AUTO INTRO -->
    <div id="introWrap">
      <video id="introVideo" autoplay muted playsinline loop></video>
      <div id="introOverlay"></div>
      <button id="skipIntro">Saltar</button>
    </div>

    <!-- AVATAR FULLSCREEN -->
    <video id="avatarBase" autoplay muted playsinline loop></video>
    <div id="vignette"></div>
    <canvas id="fx"></canvas>

    <!-- HUD -->
    <div id="hud">
      <div class="row" id="brand">
        <span class="dot" id="dotApi"></span>
        <b>CONSIA ‚àû</b>
      </div>

      <div class="row" id="statusBar">
        <span class="pill"><span class="dot" id="dotRt"></span>Realtime <b id="rtTxt">off</b></span>
        <span class="pill">API <b id="apiTxt">api.consia.world</b></span>
        <button id="btnTestApi">Test API</button>
      </div>
    </div>

    <!-- CONTROLS + CHAT -->
    <div id="controls">
      <div class="row">
        <button id="btnGuide">üß≠ Guiame (3 opciones)</button>
        <button id="btnWhat">üß† ¬øQu√© puede hacer?</button>
        <button id="btnHyper">üñºÔ∏è Hiperrealismo</button>
        <button id="btnVoice">üéôÔ∏è Voz</button>
        <button id="btnCam">üì∑ C√°mara</button>
        <button id="btnAscend">‚ö° ASCEND</button>
      </div>

      <div class="row">
        <button id="btnUpload">üìé Subir archivo</button>
        <button id="btnCamLive">üì∑ C√°mara (vivo <b id="camPct">100%</b>)</button>
        <button id="btnTalk">üó£Ô∏è Hablar</button>
        <button id="btnRead">üëÅÔ∏è Leer</button>
        <button id="btnClear">üßπ Limpiar</button>
        <button id="btnStopVoice">‚õî Stop voz</button>
        <button id="btnPlans">üí≥ Planes</button>
        <button id="btnOwner">üîí Owner</button>
      </div>

      <div id="chat">
        <div id="log"></div>
        <div id="composer">
          <input id="input" placeholder="Dec√≠ lo que quer√©s (o escrib√≠ '.')"/>
          <button id="send">Enviar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- OWNER -->
  <div id="ownerModal">
    <div id="ownerCard">
      <div class="row" style="justify-content:space-between;">
        <div class="row">
          <span class="pill">Owner Mode</span>
          <span class="pill">Comandos por voz/texto</span>
        </div>
        <div class="row">
          <button id="ownerClose">Cerrar</button>
        </div>
      </div>

      <textarea id="ownerText" placeholder="Comando Owner. Ej:
- avatar: ENTIDAD CONSIA hiperrealista, gestos perfectos, labios realistas
- plan: PRO
-
